---
import Navbar from "@sections/Navbar.astro";
import Footer from "@sections/Footer.astro";
import { ClientRouter } from "astro:transitions";
import { SEO, type Props as SEOProps } from "astro-seo";
import { Schema } from "astro-seo-schema";
import type { WithContext, Thing } from "schema-dts";
import { AstroFont } from "astro-font";
import { withBase } from "@utils/paths";
import "@styles/global.css";

interface Props {
  seo?: SEOProps; // Optional SEO properties to customize meta tags
  schema?: WithContext<Thing>; // Optional schema.org properties for structured data
}

// Extract `seo` and `schema` from properties or define defaults
const { seo, schema } = Astro.props;
const socialImage = `${Astro.site}social.png`; // Path to the default social sharing image

// Define default JSON-LD Schema.org data if no schema is passed
const defaultSchema: WithContext<Thing> = {
  "@context": "https://schema.org",
  "@type": "WebPage",
  inLanguage: "en-US",
  "@id": Astro.url.href,
  url: Astro.url.href,
  name: "Accelyze",
  description:
    "AI that Ships! Production AI services, accelerators, and advisory built by the team that keeps shipping.",
  isPartOf: {
    "@type": "WebSite",
    url: `${Astro.site}`,
    name: "Accelyze",
    description:
      "AI that Ships! Production AI services, accelerators, and advisory built by the team that keeps shipping.",
  },
};
---

<html lang="en" class="scroll-pt-32">
  <head>
    {/* SEO Meta Tags */}
    <SEO
      charset="utf-8"
      title={seo?.title ?? "Accelyze"}
      description={seo?.description ??
        "Production AI services, accelerators, and advisory built by the team that keeps shipping."}
      openGraph={{
        basic: {
          title: "Accelyze — AI that Ships!",
          type: "website",
          image: socialImage,
        },
        optional: {
          description:
            "Production AI services, accelerators, and advisory built by the team that keeps shipping.",
        },
      }}
      twitter={{
        card: "summary_large_image",
        title: "Accelyze — AI that Ships!",
        description:
          "Production AI services, accelerators, and advisory built by the team that keeps shipping.",
        image: socialImage,
        imageAlt: "Accelyze hero artwork.",
      }}
      extend={{
        link: [
          { rel: "icon", href: withBase("/icon.svg"), type: "image/svg+xml" },
          { rel: "apple-touch-icon", href: withBase("/apple-touch-icon.png") },
          { rel: "manifest", href: withBase("/manifest.webmanifest") },
        ],
        meta: [
          { name: "viewport", content: "width=device-width" },
          { name: "generator", content: `${Astro.generator}` },
        ],
      }}
    />
    <!-- Google tag (gtag.js) -->
    <script
      is:inline
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-DY626FGFQ0"></script>
    <script is:inline>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());

      gtag("config", "G-DY626FGFQ0");
    </script>
    {/* Schema.org JSON-LD */}
    <Schema item={schema ?? defaultSchema} />

    {/* Client-Side Router for page transitions */}
    <ClientRouter />

    {/* Font Definitions */}
    <AstroFont
      config={[
        {
          src: [],
          name: "DM Sans",
          googleFontsURL:
            "https://fonts.googleapis.com/css2?family=DM+Sans:opsz,wght@9..40,100..1000&display=swap",
          preload: true,
          display: "swap",
          selector: "h1, h2, h3, h4",
          fallback: "sans-serif",
        },
        {
          src: [],
          name: "Work Sans",
          googleFontsURL:
            "https://fonts.googleapis.com/css2?family=Work+Sans:wght@100..900&display=swap",
          preload: true,
          display: "swap",
          selector: "body",
          fallback: "sans-serif",
        },
      ]}
    />

    {/* Remove duplicate font links during transitions */}
    <script>
      import type { TransitionBeforeSwapEvent } from "astro:transitions/client";
      document.addEventListener("astro:before-swap", (e) =>
        [
          ...(e as TransitionBeforeSwapEvent).newDocument.head.querySelectorAll(
            'link[as="font"]',
          ),
        ].forEach((link) => link.remove()),
      );
    </script>
  </head>
  <body
    class="bg-off-white text-slate-900 selection:bg-indigo-200 selection:text-slate-900 dark:bg-slate-950 dark:text-slate-200 dark:selection:bg-indigo-500/70 dark:selection:text-white"
  >
    <Navbar />

    <main>
      <slot />
    </main>

    <Footer />

    <script is:inline>
      const HSThemeAppearance = {
        init() {
          const stored = this.getOriginalAppearance();
          this.setAppearance(stored, false);
        },
        setAppearance(
          theme,
          dispatchEvent = true,
          node = document.documentElement,
        ) {
          node.classList.remove("dark", "default");
          node.classList.add(theme === "dark" ? "dark" : "default");
          localStorage.setItem("hs_theme", theme);

          if (dispatchEvent) {
            window.dispatchEvent(
              new CustomEvent("on-hs-appearance-change", { detail: theme }),
            );
          }
        },
        getOriginalAppearance() {
          return localStorage.getItem("hs_theme") || "default";
        },
      };

      window.HSThemeAppearance = HSThemeAppearance;
      HSThemeAppearance.init();

      window
        .matchMedia("(prefers-color-scheme: dark)")
        .addEventListener("change", () => {
          if (HSThemeAppearance.getOriginalAppearance() === "auto") {
            HSThemeAppearance.setAppearance("auto", false);
          }
        });

      window.addEventListener("load", () => {
        const clickable = document.querySelectorAll(
          "[data-hs-theme-click-value]",
        );

        clickable.forEach(($item) => {
          $item.addEventListener("click", () =>
            HSThemeAppearance.setAppearance(
              $item.getAttribute("data-hs-theme-click-value"),
              true,
            ),
          );
        });
      });
    </script>
  </body>
</html>
